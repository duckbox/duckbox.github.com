/***
	
	Example backbone.js Shopping Cart

	by @duckbox

	Blog post : http://duckbox/2

**//*global jQuery *//*global _ *//*global Backbone */// Generic Namespace for our App
var App={Collection:{},Model:{},View:{}};App.Model.Item=Backbone.Model.extend({defaults:{price:.99,quantity:0,total:0},total:function(){var e=this.get("price")*this.get("quantity");this.set("total",e);return e},quanity:function(e){var t=this.get("quantity");this.set("quantity",e==="increase"?++t:--t)}});App.Collection.Items=Backbone.Collection.extend({models:App.Model.Item,subtotal:function(){var e=0;this.each(function(t){e+=t.total()});return e.toFixed(2)}});App.View.Item=Backbone.View.extend({tagName:"li",template:$("#tmp-shoppingListItem").html(),events:{click:"addToCart"},initialize:function(){this.render()},render:function(){this.$el.html(_.template(this.template,this.model.toJSON()));return this},addToCart:function(){App.cart.add(this.model)}});App.View.ItemList=Backbone.View.extend({el:"#default-item-list",initialize:function(){this.render()},render:function(){this.collection.each(function(e){var t=new App.View.Item({model:e});this.$el.append(t.render().el)},this)}});App.View.ShoppingCartItemView=Backbone.View.extend({tagName:"tr",template:$("#tmp-shoppingCartItem").html(),events:{"click .name":"remove","click .quantity":"manageQuantity"},initialize:function(){this.render();this.model.on("change",function(){this.render()},this)},render:function(){this.$el.html(_.template(this.template,this.model.toJSON()));return this},manageQuantity:function(e){var t=$(e.target).data("type");this.model.get("quantity")===1&&t==="decrease"?this.remove():this.model.quanity(t)},remove:function(){this.$el.fadeOut(500,function(){$(this).remove()});App.cartItems.remove(this.model)}});App.View.ShoppingCart=Backbone.View.extend({el:"#shopping-list",total:$("#total"),basketTotal:$("#basket"),initialize:function(){this.collection=App.cartItems;this.defaultMessage();this.collection.on("add remove change:quantity",function(e){this.updateTotal();this.collection.length===0&&this.defaultMessage()},this)},defaultMessage:function(){this.$el.addClass("empty").html('<tr><td colspan="4">Cart is empty</td></tr>')},add:function(e){this.$el.removeClass("empty");e.quanity("increase");this.collection.add(e);this.render()},updateTotal:function(){var e=0;this.collection.each(function(t){e+=t.get("quantity")});this.basketTotal.html(e);this.total.html(this.collection.subtotal())},render:function(){this.$el.html("");this.collection.each(function(e){var t=new App.View.ShoppingCartItemView({model:e});this.$el.append(t.render().el)},this)}});var defaultItems=[{title:"Bacon",price:2.99},{title:"Cabbage"},{title:"Spinnach",price:1.4},{title:"Salt",price:.88},{title:"Bread"},{title:"Butter",price:1.99}];App.items=new App.Collection.Items;App.cartItems=new App.Collection.Items;App.cartItems.on("add",function(e){e.set("quantity",1)});for(var i in defaultItems)App.items.add(new App.Model.Item(defaultItems[i]));App.cart=new App.View.ShoppingCart;$(function(){App.itemList=new App.View.ItemList({collection:App.items})});